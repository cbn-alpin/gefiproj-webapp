
<div>
  <span class="title">{{title}}</span>
  <span class="result">{{getResult()}}</span>
</div>
<div class="table-generic">

<table mat-table [(dataSource)]="genericTableData" class="mat-elevation-z8" [ngClass]="{'can-select': canSelect}">

  <ng-container *ngFor="let columnName of dataSourceColumnsName; let index = index" [matColumnDef]="columnName.name">
    <th mat-header-cell *matHeaderCellDef> {{columnName.name}} </th>
    <td mat-cell *matCellDef="let element">

      <!-- Textarea -->
      <div class="textarea">
          <mat-form-field *ngIf="isTextarea(columnName.code)" [ngClass]="{errors: hasErrors(element, columnName.code)}" floatLabel="never">
            <textarea matInput *ngIf="element.state === GenericTableEntityState.EDIT" matTooltipClass="tooltip-error"
              [matTooltip]="getErrorMessage(element.errors, columnName.code)"
              [(ngModel)]="element.data[columnName.code]"
              [placeholder]="getPlaceHolder(columnName.code)"></textarea>
            <div *ngIf="element.state === GenericTableEntityState.READ" matTooltip="{{element.data[columnName.code]}}"
            matTooltipClass="tooltip-textarea">

            <textarea matInput [disabled]="element.state === GenericTableEntityState.READ"
              [(ngModel)]="element.data[columnName.code]"
              [placeholder]="getPlaceHolder(columnName.code)"
              rows="4" cols="50" maxlength="50"></textarea>
            </div>
          </mat-form-field>
      </div>

      <!-- String -->
      <div class="string">
        <mat-form-field *ngIf="isString(columnName.code)" [ngClass]="{errors: hasErrors(element, columnName.code)}" floatLabel="never">
          <input matInput [disabled]="element.state === GenericTableEntityState.READ" matTooltipClass="tooltip-error"
                 [matTooltip]="getErrorMessage(element.errors, columnName.code)"
                 [(ngModel)]="element.data[columnName.code]"
                 [placeholder]="getPlaceHolder(columnName.code)">
        </mat-form-field>
      </div>

      <!-- Number -->
      <div class="number">
        <mat-form-field *ngIf="isNumber(columnName.code)" [ngClass]="{errors: hasErrors(element, columnName.code)}" floatLabel="never">
          <input matInput numeric [disabled]="element.state === GenericTableEntityState.READ" matTooltipClass="tooltip-error"
                 type="number"
                 [matTooltip]="getErrorMessage(element.errors, columnName.code)"
                 [(ngModel)]="element.data[columnName.code]"
                 [placeholder]="getPlaceHolder(columnName.code)">
        </mat-form-field>
      </div>

      <!-- Date -->
      <div class="date">
        <mat-form-field *ngIf="isDate(columnName.code)" [ngClass]="{errors: hasErrors(element, columnName.code)}" floatLabel="never">
          <input matInput [disabled]="element.state === GenericTableEntityState.READ" [matDatepicker]="picker1" matTooltipClass="tooltip-error"
                 [matTooltip]="getErrorMessage(element.errors, columnName.code)"
                 [(ngModel)]="element.data[columnName.code]"
                 [placeholder]="getPlaceHolder(columnName.code)">
          <mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>
          <mat-datepicker #picker1></mat-datepicker>
        </mat-form-field>
      </div>

      <!-- Currency -->
      <div class="currency">
        <mat-form-field *ngIf="isCurrency(columnName.code)" [ngClass]="{errors: hasErrors(element, columnName.code)}" floatLabel="never">
          <input matInput numeric decimals="2" [disabled]="element.state === GenericTableEntityState.READ" matTooltipClass="tooltip-error"
                 [matTooltip]="getErrorMessage(element.errors, columnName.code)"
                 [ngModel]="element.state === GenericTableEntityState.READ ? ((element.data[columnName.code] | number:'1.0-0': 'fr-FR') + ' â‚¬') : element.data[columnName.code]"
                 (ngModelChange)="element.data[columnName.code] = +$event"
                 [placeholder]="getPlaceHolder(columnName.code)">
        </mat-form-field>
      </div>

      <!-- Boolean -->
      <div class="checkbox">
        <mat-checkbox *ngIf="isBoolean(columnName.code)" [(ngModel)]="element.data[columnName.code]"
                      [disabled]="element.state === GenericTableEntityState.READ">
        </mat-checkbox>
      </div>

      <!-- Select box -->
      <div class="selectbox">
        <mat-form-field *ngIf="isSelectBox(columnName.code)" [ngClass]="{errors: hasErrors(element, columnName.code)}" floatLabel="never">
          <mat-select [(ngModel)]="element.data[columnName.code]" [disabled]="element.state === GenericTableEntityState.READ" matTooltipClass="tooltip-error"
            [matTooltip]="getErrorMessage(element.errors, columnName.code)">
            <mat-option *ngFor="let option of getEntitySelectBoxOptions(columnName.code)" [value]="option">{{option}}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>

    </td>
  </ng-container>

  <ng-container [matColumnDef]="actionsHeaderColumns" stickyEnd *ngIf="showActions">
    <th mat-header-cell *matHeaderCellDef>
      {{actionsHeaderColumns}}
      <button mat-icon-button (click)="onCreate()" [disabled]="canCreate()">
        <mat-icon>add</mat-icon>
      </button>
    </th>
    <td mat-cell *matCellDef="let element">
      <span *ngIf="element.state === GenericTableEntityState.READ">
        <button mat-icon-button (click)="onEdit($event, element)">
          <mat-icon>edit</mat-icon>
        </button>
        <button mat-icon-button (click)="openDeletionConfirmationDialog($event, element)">
          <mat-icon>delete</mat-icon>
        </button>
      </span>
      <span *ngIf="element.state === GenericTableEntityState.EDIT">
        <button mat-icon-button (click)="edit($event, element)">
          <mat-icon>done</mat-icon>
        </button>
        <button mat-icon-button (click)="cancelEditing($event, element)">
          <mat-icon>clear</mat-icon>
        </button>
      </span>
      <span *ngIf="element.state === GenericTableEntityState.NEW">
        <button mat-icon-button (click)="create($event, element)">
          <mat-icon>done</mat-icon>
        </button>
        <button mat-icon-button (click)="cancelCreation($event, element)">
          <mat-icon>clear</mat-icon>
        </button>
      </span>
    </td>
  </ng-container>

  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
  <tr mat-row *matRowDef="let row; columns: displayedColumns;" [ngClass]="{'selected': selectedEntity === row}" (click)="select(row)"></tr>
</table>

</div>