<div>
  <span *ngIf="!!title" class="title">{{title}}</span>
</div>
<div class="table-generic mat-elevation-z8">

  <table mat-table [(dataSource)]="genericTableData" [ngClass]="{'can-select': canSelect}"
    matSort matSortDisableClear [matSortActive]="sortName" [matSortDirection]="sortDirection">

    <ng-container *ngFor="let columnName of dataSourceColumnsName; let index = index" [matColumnDef]="columnName.name">
      <th mat-header-cell *matHeaderCellDef mat-sort-header [disabled]="isSortDisabled(columnName.code)"> {{columnName.name}} </th>
      <td mat-cell *matCellDef="let element">

      <!-- Textarea -->
      <div class="ttextarea">
        <div *ngIf="isTextarea(columnName.code)">
          <mat-form-field *ngIf="element.state === GenericTableEntityState.EDIT; else overlay"
          [ngClass]="{errors: hasErrors(element, columnName.code)}"
          floatLabel="never">
            <textarea matInput matTooltipClass="tooltip-error"
              [disabled]="disabledEditField(element, columnName.code)"
              [matTooltip]="getErrorMessage(element.errors, columnName.code)"
              [(ngModel)]="element.data[columnName.code]"
              [placeholder]="getPlaceHolder(columnName.code)"></textarea>
          </mat-form-field>
          <!--HOVERLAY-->
          <ng-template #overlay>
            <mat-form-field matTooltip="{{element.data[columnName.code]}}" matTooltipClass="tooltip-textarea"
              [ngClass]="{errors: hasErrors(element, columnName.code)}" floatLabel="never">
              <textarea matInput [disabled]="element.state === GenericTableEntityState.READ"
                [(ngModel)]="element.data[columnName.code]"
                [placeholder]="getPlaceHolder(columnName.code)"
                rows="4" cols="50" maxlength="50"></textarea>
            </mat-form-field>
          </ng-template>
        </div>
      </div>

        <!-- String -->
        <div class="string">
          <mat-form-field *ngIf="isString(columnName.code)" [ngClass]="{errors: hasErrors(element, columnName.code)}" floatLabel="never">
            <input matInput [disabled]="element.state === GenericTableEntityState.READ || disabledEditField(element, columnName.code)"
              matTooltipClass="tooltip-error"
              [matTooltip]="getErrorMessage(element.errors, columnName.code)"
              [(ngModel)]="element.data[columnName.code]"
              [placeholder]="getPlaceHolder(columnName.code)">
          </mat-form-field>
        </div>

        <!-- Number -->
        <div class="number">
          <mat-form-field *ngIf="isNumber(columnName.code)" [ngClass]="{errors: hasErrors(element, columnName.code)}" floatLabel="never">
            <input matInput numeric [disabled]="element.state === GenericTableEntityState.READ || disabledEditField(element, columnName.code)"
              matTooltipClass="tooltip-error"
              [matTooltip]="getErrorMessage(element.errors, columnName.code)"
              [(ngModel)]="element.data[columnName.code]"
              [placeholder]="getPlaceHolder(columnName.code)">
          </mat-form-field>
        </div>

        <!-- Date -->
        <div class="date">
          <mat-form-field *ngIf="isDate(columnName.code)" [ngClass]="{errors: hasErrors(element, columnName.code)}" floatLabel="never">
            <input matInput [disabled]="element.state === GenericTableEntityState.READ || disabledEditField(element, columnName.code)"
              [matDatepicker]="picker1" matTooltipClass="tooltip-error"
              [matTooltip]="getErrorMessage(element.errors, columnName.code)"
              [(ngModel)]="element.data[columnName.code]"
              [placeholder]="getPlaceHolder(columnName.code)">
            <mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>
            <mat-datepicker #picker1></mat-datepicker>
          </mat-form-field>
        </div>

        <!-- Currency -->
        <div class="currency">
          <mat-form-field *ngIf="isCurrency(columnName.code)" [ngClass]="{errors: hasErrors(element, columnName.code)}" floatLabel="never">
            <input matInput numeric decimals="4"
              [disabled]="element.state === GenericTableEntityState.READ || disabledEditField(element, columnName.code)"
              matTooltipClass="tooltip-error" [matTooltip]="getErrorMessage(element.errors, columnName.code)"
              [ngModel]="element.state === GenericTableEntityState.READ ? ((element.data[columnName.code] | number:'1.0-0': 'fr-FR') + ' €') : element.data[columnName.code]"
              (ngModelChange)="element.data[columnName.code]=$event"
              [placeholder]="getPlaceHolder(columnName.code)">
          </mat-form-field>
        </div>

        <!-- Boolean -->
        <div class="checkbox">
          <mat-checkbox *ngIf="isBoolean(columnName.code)" [(ngModel)]="element.data[columnName.code]"
            [disabled]="element.state === GenericTableEntityState.READ || disabledEditField(element, columnName.code)">
          </mat-checkbox>
        </div>

        <!-- Select box -->
        <div class="selectbox">
          <mat-form-field *ngIf="isSelectBox(columnName.code)" [ngClass]="{errors: hasErrors(element, columnName.code)}" floatLabel="never">
            <mat-select [(ngModel)]="element.data[columnName.code]"
              [disabled]="element.state === GenericTableEntityState.READ || disabledEditField(element, columnName.code)"
              matTooltipClass="tooltip-error" [matTooltip]="getErrorMessage(element.errors, columnName.code)">
              <mat-option *ngFor="let option of getEntitySelectBoxOptions(columnName.code)" [value]="option.id">
                {{option.label}}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>

      </td>
    </ng-container>

    <ng-container [matColumnDef]="actionsHeaderColumns" stickyEnd *ngIf="showActions">
      <th mat-header-cell *matHeaderCellDef class="actions">

        {{actionsHeaderColumns}}
        <button *ngIf="!isReadOnly" mat-icon-button (click)="onCreate()" [disabled]="canCreate()">
          <mat-icon>add</mat-icon>
        </button>
      </th>
      <td mat-cell *matCellDef="let element" class="actions">
        <div fxLayout="row" fxLayoutAlign="space-between center">
          <span *ngIf="element.state === GenericTableEntityState.READ">
            <button *ngIf="withNagivation" mat-icon-button (click)="onNavigate(element)">
              <mat-icon>open_in_browser</mat-icon>
            </button>
            <button *ngIf="!isReadOnly" mat-icon-button (click)="onEdit($event, element)">
              <mat-icon>edit</mat-icon>
            </button>
            <button *ngIf="!isReadOnly" mat-icon-button (click)="delete(element)">
              <mat-icon>delete</mat-icon>
            </button>
          </span>
          <span *ngIf="!isReadOnly && element.state === GenericTableEntityState.EDIT">
            <button mat-icon-button (click)="edit($event, element)">
              <mat-icon>done</mat-icon>
            </button>
            <button mat-icon-button (click)="cancelEditing($event, element)">
              <mat-icon>clear</mat-icon>
            </button>
          </span>
          <span *ngIf="!isReadOnly && element.state === GenericTableEntityState.NEW">
            <button mat-icon-button (click)="create($event, element)">
              <mat-icon>done</mat-icon>
            </button>
            <button mat-icon-button (click)="cancelCreation($event, element)">
              <mat-icon>clear</mat-icon>
            </button>
          </span>
        </div>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"
        [ngClass]="{'selected': selectedEntity === row, 'default-row': ((selectedEntity === null || selectedEntity === undefined) && canSelect)}"
      (click)="select(row)"></tr>
  </table>

</div>

<p *ngIf="isEmpty">(Aucun élément à afficher)</p>
<span class="result">{{getResult()}}</span>
